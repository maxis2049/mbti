<!--pages/result/result.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-icon">ğŸ“Š</view>
      <view class="loading-text">æ­£åœ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š...</view>
      <view class="loading-tip">è¯·ç¨å€™ç‰‡åˆ»</view>
    </view>
  </view>

  <!-- ç»“æœå†…å®¹ -->
  <view class="result-container" wx:if="{{!loading && mbtiResult && mbtiReport}}">
    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
    <view class="result-header">
      <view class="header-left">
        <view class="type-card">
          <view class="type-title">{{mbtiResult.mbti_type}}</view>
          <view class="type-subtitle">{{mbtiReport.metadata.nickname}}</view>
        </view>
        <view class="info-item">
          <view class="info-label">æµ‹è¯•ç‰ˆæœ¬</view>
          <view class="info-value">{{mbtiResult.test_version === 'simple' ? 'å¿«é€Ÿæµ‹è¯•' : 'æ·±åº¦æµ‹è¯•'}}</view>
        </view>
      </view>
      
      <view class="header-right">
        <view class="test-info">
          <view class="info-label">æµ‹è¯•ç”¨æ—¶</view>
          <view class="info-value">{{formatTime(mbtiResult.test_duration)}}</view>
        </view>
        <view class="test-info">
          <view class="info-label">æµ‹è¯•æ—¶é—´</view>
          <view class="info-value">{{formatDate(mbtiResult.created_at)}}</view>
        </view>
      </view>
    </view>

    <!-- ä¸»æ ‡é¢˜åŒºåŸŸ -->
    <view class="main-title-section">
      <view class="title-icon">{{mbtiReport.metadata.title}}</view>
      <view class="title-main">{{mbtiReport.metadata.nickname}}</view>
      <view class="title-subtitle">{{mbtiReport.personality_profile.imagery}}</view>
    </view>

    <!-- äººæ ¼æè¿° -->
    <view class="personality-section">
      <view class="section-title">äººæ ¼ç”»åƒ</view>
      <view class="personality-card">
        <view class="card-description">{{mbtiReport.personality_profile.description}}</view>
        <view class="card-analysis">
          <view class="analysis-item">
            <view class="analysis-icon">ğŸ§ </view>
            <view class="analysis-content">
              <view class="analysis-title">å¿ƒç†å­¦è§£æ</view>
              <view class="analysis-text">{{mbtiReport.personality_profile.psychological_analysis}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¶…èƒ½åŠ›å±•ç¤º -->
    <view class="superpowers-section">
      <view class="section-title">è¶…èƒ½åŠ›æ¸…å•</view>
      <view class="superpowers-grid">
        <view 
          class="superpower-item"
          wx:for="{{mbtiReport.superpowers}}"
          wx:key="ability"
        >
          <view class="power-icon">âœ¨</view>
          <view class="power-content">
            <view class="power-title">{{item.ability}}</view>
            <view class="power-desc">{{item.description}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»´åº¦åˆ†æ -->
    <view class="dimensions-section">
      <view class="section-title">ç»´åº¦åˆ†æ</view>
      <view class="dimensions-card">
        <view class="dimensions-grid">
          <!-- EI ç»´åº¦ -->
          <view class="dimension-item">
            <view class="dimension-type">
              <text class="dimension-name">{{mbtiResult.dimension_details.EI.winner}}</text>
              <text class="dimension-full">{{dimensionNames[mbtiResult.dimension_details.EI.winner]}}</text>
            </view>
            <view class="dimension-scores">
              <view class="score-pair">
                <text class="score-label E">E: {{mbtiResult.dimension_details.EI.E}}</text>
                <text class="score-label I">I: {{mbtiResult.dimension_details.EI.I}}</text>
              </view>
            </view>
            <view class="dimension-strength" wx:if="{{mbtiResult.strengths}}">
              <view class="strength-bar">
                <view class="strength-fill" style="width: {{mbtiResult.strengths.EI_strength}}%"></view>
              </view>
              <view class="strength-text">{{mbtiResult.strengths.EI_strength}}%</view>
              <view class="strength-desc">{{getStrengthDescription(mbtiResult.strengths.EI_strength)}}</view>
            </view>
          </view>
          
          <!-- SN ç»´åº¦ -->
          <view class="dimension-item">
            <view class="dimension-type">
              <text class="dimension-name">{{mbtiResult.dimension_details.SN.winner}}</text>
              <text class="dimension-full">{{dimensionNames[mbtiResult.dimension_details.SN.winner]}}</text>
            </view>
            <view class="dimension-scores">
              <view class="score-pair">
                <text class="score-label S">S: {{mbtiResult.dimension_details.SN.S}}</text>
                <text class="score-label N">N: {{mbtiResult.dimension_details.SN.N}}</text>
              </view>
            </view>
            <view class="dimension-strength" wx:if="{{mbtiResult.strengths}}">
              <view class="strength-bar">
                <view class="strength-fill" style="width: {{mbtiResult.strengths.SN_strength}}%"></view>
              </view>
              <view class="strength-text">{{mbtiResult.strengths.SN_strength}}%</view>
              <view class="strength-desc">{{getStrengthDescription(mbtiResult.strengths.SN_strength)}}</view>
            </view>
          </view>
          
          <!-- TF ç»´åº¦ -->
          <view class="dimension-item">
            <view class="dimension-type">
              <text class="dimension-name">{{mbtiResult.dimension_details.TF.winner}}</text>
              <text class="dimension-full">{{dimensionNames[mbtiResult.dimension_details.TF.winner]}}</text>
            </view>
            <view class="dimension-scores">
              <view class="score-pair">
                <text class="score-label T">T: {{mbtiResult.dimension_details.TF.T}}</text>
                <text class="score-label F">F: {{mbtiResult.dimension_details.TF.F}}</text>
              </view>
            </view>
            <view class="dimension-strength" wx:if="{{mbtiResult.strengths}}">
              <view class="strength-bar">
                <view class="strength-fill" style="width: {{mbtiResult.strengths.TF_strength}}%"></view>
              </view>
              <view class="strength-text">{{mbtiResult.strengths.TF_strength}}%</view>
              <view class="strength-desc">{{getStrengthDescription(mbtiResult.strengths.TF_strength)}}</view>
            </view>
          </view>
          
          <!-- JP ç»´åº¦ -->
          <view class="dimension-item">
            <view class="dimension-type">
              <text class="dimension-name">{{mbtiResult.dimension_details.JP.winner}}</text>
              <text class="dimension-full">{{dimensionNames[mbtiResult.dimension_details.JP.winner]}}</text>
            </view>
            <view class="dimension-scores">
              <view class="score-pair">
                <text class="score-label J">J: {{mbtiResult.dimension_details.JP.J}}</text>
                <text class="score-label P">P: {{mbtiResult.dimension_details.JP.P}}</text>
              </view>
            </view>
            <view class="dimension-strength" wx:if="{{mbtiResult.strengths}}">
              <view class="strength-bar">
                <view class="strength-fill" style="width: {{mbtiResult.strengths.JP_strength}}%"></view>
              </view>
              <view class="strength-text">{{mbtiResult.strengths.JP_strength}}%</view>
              <view class="strength-desc">{{getStrengthDescription(mbtiResult.strengths.JP_strength)}}</view>
            </view>
          </view>
        </view>
        
        <!-- ç½®ä¿¡åº¦æ˜¾ç¤º -->
        <view class="confidence-section" wx:if="{{mbtiResult.confidence}}">
          <view class="confidence-title">æµ‹è¯•ç½®ä¿¡åº¦</view>
          <view class="confidence-value">{{mbtiResult.confidence}}%</view>
          <view class="confidence-level">{{getConfidenceLevel(mbtiResult.confidence).level}}</view>
          <view class="confidence-bar">
            <view class="confidence-fill" style="width: {{mbtiResult.confidence}}%; background: {{getConfidenceLevel(mbtiResult.confidence).color}}"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- èŒåœºæŒ‡å— -->
    <view class="career-section">
      <view class="section-title">èŒåœºäººæ ¼</view>
      <view class="career-card">
        <view class="career-motto">"{{mbtiReport.career_profile.motto}}"</view>
        <view class="career-roles">
          <view class="roles-title">é€‚åˆè§’è‰²</view>
          <view class="roles-grid">
            <view 
              class="role-item"
              wx:for="{{mbtiReport.career_profile.suitable_roles}}"
              wx:key="category"
            >
              <view class="role-category">{{item.category}}</view>
              <view class="role-positions">{{item.positions.join('ã€')}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ‹çˆ±æŒ‡å— -->
    <view class="love-section">
      <view class="section-title">æ‹çˆ±æŒ‡å—</view>
      <view class="love-card">
        <view class="love-item">
          <view class="love-icon">ğŸ’•</view>
          <view class="love-content">
            <view class="love-title">ç†æƒ³å‹</view>
            <view class="love-text">{{mbtiReport.love_guide.ideal_partner}}</view>
          </view>
        </view>
        <view class="love-item">
          <view class="love-icon">ğŸ’—</view>
          <view class="love-content">
            <view class="love-title">æ‹çˆ±æ¨¡å¼</view>
            <view class="love-text">{{mbtiReport.love_guide.relationship_mode}}</view>
          </view>
        </view>
        <view class="love-item">
          <view class="love-icon">ğŸ’</view>
          <view class="love-content">
            <view class="love-title">è¡¨ç™½æ–¹å¼</view>
            <view class="love-text">{{mbtiReport.love_guide.confession_style}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="action-section">
      <view class="action-buttons">
        <button class="action-btn secondary" bindtap="viewDetailedAnalysis">
          <view class="btn-icon">ğŸ“Š</view>
          <view class="btn-text">è¯¦ç»†è§£æ</view>
        </button>
        <button class="action-btn secondary" bindtap="generateImageReport">
          <view class="btn-icon">ğŸ–¼ï¸</view>
          <view class="btn-text">ç”Ÿæˆå›¾ç‰‡</view>
        </button>
        <button class="action-btn primary" bindtap="retakeTest">
          <view class="btn-icon">ğŸ”„</view>
          <view class="btn-text">é‡æ–°æµ‹è¯•</view>
        </button>
        <button class="action-btn secondary {{isFavorite ? 'active' : ''}}" bindtap="toggleFavorite">
          <view class="btn-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</view>
          <view class="btn-text">{{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</view>
        </button>
        <button class="action-btn secondary" open-type="share">
          <view class="btn-icon">ğŸ“¤</view>
          <view class="btn-text">åˆ†äº«ç»“æœ</view>
        </button>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«æç¤º -->
  <view class="share-tip" wx:if="{{!loading && mbtiResult && !isShared}}">
    <view class="tip-content">
      <text class="tip-icon">ğŸ’¡</text>
      <text class="tip-text">åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œçœ‹çœ‹å¤§å®¶éƒ½æ˜¯ä»€ä¹ˆæ€§æ ¼ç±»å‹ï¼</text>
    </view>
  </view>
</view>