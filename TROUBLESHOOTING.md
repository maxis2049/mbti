# 云函数部署故障排除指南

## 🔍 常见问题及解决方案

### 问题1: "ResourceNotFound.Function" 错误
**现象**: 调用云函数时提示"未找到指定的Function"

**原因**: 云函数没有成功部署

**解决方案**:
1. **检查环境ID**
   ```javascript
   // 确保app.js中的环境ID正确
   env: "你的实际环境ID" // 替换为云开发控制台显示的ID
   ```

2. **重新部署云函数**
   - 右键点击 `cloudfunctions/mbti-service`
   - 选择 **"上传并部署：云端安装依赖"**
   - 等待看到"上传成功"提示

3. **验证部署**
   - 点击工具栏"云开发"
   - 选择"云函数"标签
   - 确认 `mbti-service` 在列表中

### 问题2: 网络连接问题
**现象**: 部署失败或调用失败

**解决方案**:
1. 检查网络连接
2. 重启微信开发者工具
3. 清理缓存：工具 → 清理缓存 → 全部清理

### 问题3: 权限问题
**现象**: 云函数调用时提示权限错误

**解决方案**:
1. **检查云开发环境权限**
   - 云开发控制台 → 设置 → 权限设置
   - 确保所有权限都已开启

2. **检查安全规则**
   - 云开发控制台 → 数据库
   - 确认集合的安全规则配置正确

### 问题4: 依赖包问题
**现象**: 部署时提示依赖包错误

**解决方案**:
1. **清理并重新安装依赖**
   ```bash
   cd cloudfunctions/mbti-service
   rm -rf node_modules package-lock.json
   npm install
   ```

2. **检查package.json**
   ```json
   {
     "dependencies": {
       "wx-server-sdk": "~2.4.0"
     }
   }
   ```

## 🔧 部署检查清单

### 部署前检查
- [ ] 微信开发者工具已登录
- [ ] 项目正确加载
- [ ] 云开发环境已创建
- [ ] 环境ID已正确配置
- [ ] 云函数文件结构完整

### 部署步骤
- [ ] 右键点击云函数文件夹
- [ ] 选择"上传并部署：云端安装依赖"
- [ ] 等待部署完成（看到成功提示）
- [ ] 在云开发控制台验证函数存在

### 部署后验证
- [ ] 云函数在控制台可见
- [ ] 可以成功调用云函数
- [ ] 数据库操作正常
- [ ] 小程序功能正常

## 🚀 快速重置流程

如果以上方法都不行，尝试重置：

1. **删除云函数**
   - 云开发控制台 → 云函数 → 删除 `mbti-service`

2. **清理本地缓存**
   - 微信开发者工具 → 工具 → 清理缓存 → 全部清理

3. **重启项目**
   - 关闭微信开发者工具
   - 重新打开项目

4. **重新部署**
   - 右键点击云函数文件夹
   - 选择"上传并部署：云端安装依赖"

## 📞 获取帮助

如果问题仍然存在：

1. **查看日志**
   - 云开发控制台 → 云函数 → 日志
   - 检查错误详情

2. **检查网络**
   - 确保可以访问腾讯云服务
   - 尝试切换网络环境

3. **控制台输出**
   - 微信开发者工具 → Console
   - 查看详细的错误信息